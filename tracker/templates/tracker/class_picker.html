{% load static %}
<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <title>üå∏ Hello Kitty Fitness üå∏</title>
    <link rel="stylesheet" href="{% static 'tracker/css/class_picker.css' %}">
    <!--font Modak and DynaPuff-->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link
        href="https://fonts.googleapis.com/css2?family=Alfa+Slab+One&family=DynaPuff:wght@400..700&family=Maven+Pro:wght@400..900&family=Modak&family=Rubik+Bubbles&family=Sigmar+One&display=swap"
        rel="stylesheet">
</head>

<body>
    <script>
        function getCookie(name) {
            let cookieValue = null;
            if (document.cookie && document.cookie !== "") {
                const cookies = document.cookie.split(";");
                for (let i = 0; i < cookies.length; i++) {
                    const cookie = cookies[i].trim();
                    if (cookie.substring(0, name.length + 1) === name + "=") {
                        cookieValue = decodeURIComponent(cookie.substring(name.length + 1));
                        break;
                    }
                }
            }
            return cookieValue;
        }
        const csrftoken = getCookie("csrftoken");
    </script>


    <div id="aboutPopup" class="popup-overlay">
        <div class="popup-box">
        <div class="popup-inner">
            <h2 class="popup-title">About us</h2>
            <p class ="popup-desc">
            Beautiful and passionate souls converge to create Kitty Fitness - 
            a space where technology meets emotion, radiating the energy of love and warmth üíñ
            </p>

            <ul class="popup-members">
            <li>11245870 ‚Äì Nguy·ªÖn Kh√°nh Duy</li>
            <li>11245886 ‚Äì Tr·∫ßn Th·ªã Nh·∫≠t Kh√°nh</li>
            <li>11245840 ‚Äì V≈© ƒê·ª©c Anh</li>
            <li>11245892 ‚Äì L√™ Ph·∫°m Kh√°nh Linh</li>
            <li>11245921 ‚Äì Ho√†ng Th·ª•c Nhi</li>
            <li>11245899 ‚Äì V≈© Tr·∫ßn C√°t Linh</li>
            </ul>
            
            <img class="kitty-left" src="{% static 'tracker/images/pop-up1.png' %}">
            <img class="kitty-right" src="{% static 'tracker/images/pop-up2.png' %}">
        </div>
        </div>
    </div>

    <!-- Header -->
    <header>
        <div class="logo">
        <img src= {% static 'tracker/images/gif3.gif' %} alt="Kitty Logo">
        <h1>Kitty Fitness</h1>
        </div>
        <nav>
        <a href="#" id="aboutBtn">About us</a>
        </nav>
    </header>



    <!--S·ª≠a ·ªü ƒë√¢y-->
    <div class="plan-main-content">
        <h1 class="main-title">ü§∏‚Äç‚ôÇÔ∏è Pick a class type and build your workout plan üèãÔ∏è‚Äç‚ôÄÔ∏è</h1>

        <form class="plan-generator-form" id="planForm">

            <div class="plan-section">
                <h2 class="section-title">üèÉ Priority Activity Group</h2>
                <div class="input-group">
                    <label>Select your focus activity group:</label>
                    <div class="activity-selector">

                        <input type="radio" id="outdoor" name="activity" value="Outdoor">
                        <label for="outdoor" class="icon-label">
                            <span class="activity-icon fas fa-mountain"></span>
                            <span>üèù Outdoor</span>
                        </label>

                        <input type="radio" id="art" name="activity" value="Art">
                        <label for="art" class="icon-label">
                            <span class="activity-icon fas fa-masks-theater"></span>
                            <span>üíÉ Art</span>
                        </label>

                        <input type="radio" id="indoor" name="activity" value="Indoor">
                        <label for="indoor" class="icon-label">
                            <span class="activity-icon fas fa-house-chimney"></span>
                            <span>üè° Indoor</span>
                        </label>

                        <input type="radio" id="resistance" name="activity" value="Resistance">
                        <label for="resistance" class="icon-label">
                            <span class="activity-icon fas fa-weight-hanging"></span>
                            <span>üèãÔ∏è Resistance Training</span>
                        </label>

                        <input type="radio" id="sport" name="activity" value="Sports">
                        <label for="sport" class="icon-label">
                            <span class="activity-icon fas fa-basketball-ball"></span>
                            <span>üèÄ Sports</span>
                        </label>
                    </div>
                </div>
            </div>

            <div class="plan-section">
                <h2 class="section-title">üóì Workout Frequency & Duration</h2>

                <div class="input-group">
                    <label>Training days of the week:</label>
                    <div class="day-selector">
                        <input type="checkbox" id="mon" name="days" value="Monday" ><label for="mon">Monday</label>
                        <input type="checkbox" id="tues" name="days" value="Tuesday"><label for="tues">Tuesday</label>
                        <input type="checkbox" id="wed" name="days" value="Wednesday" ><label for="wed">Wednesday</label>
                        <input type="checkbox" id="thu" name="days" value="Thursday"><label for="thu">Thursday</label>
                        <input type="checkbox" id="fri" name="days" value="Friday" ><label for="fri">Friday</label>
                        <input type="checkbox" id="sat" name="days" value="Saturday"><label for="sat">Saturday</label>
                        <input type="checkbox" id="sun" name="days" value="Sunday"><label for="sun">Sunday</label>
                    </div>
                </div>
            </div>

            <div class="plan-section target-section">
                <h2 class="section-title">üî• Weekly Target for Calorie Burn</h2>
                <div class="slider-group">
                    <label for="weekly_target">Total weekly calorie burn target (kcal):</label>
                    <div class="slider-display">
                        <span id="targetValue">1500 kcal</span>
                        <input type="range" id="weekly_target" name="weekly_target" min="500" max="10000" value="1500"
                            step="10">
                    </div>
                </div>
            </div>

            <button type="submit" class="generate-btn" id="generateBtn">
                GENERATE NOW
            </button>

        </form>

        <div class="popup-overlay" id="planPopup">
            <div class="plan-box">
                <h2 class="schedule-title">üìÖ PERSONAL WORKOUT PLAN</h2>
                <div id="planDetails" class="plan-table-container">
                </div>

                <button type="button" class="close-plan-btn" onclick="closePopup()">Close & Continue</button>
            </div>
        </div>

    </div>

    <script>
        document.addEventListener('DOMContentLoaded', () => {
            const weeklyTargetSlider = document.getElementById('weekly_target');
            const targetValueDisplay = document.getElementById('targetValue');
            const planForm = document.getElementById('planForm');
            const planPopup = document.getElementById('planPopup');
            const planDetails = document.getElementById('planDetails');

            // --- 1. C·∫≠p nh·∫≠t gi√° tr·ªã Slider ---
            weeklyTargetSlider.addEventListener('input', () => {
                targetValueDisplay.textContent = `${weeklyTargetSlider.value} kcal`;
            });

            // Kh·ªüi t·∫°o gi√° tr·ªã ban ƒë·∫ßu (ƒë·∫£m b·∫£o hi·ªÉn th·ªã ƒë√∫ng khi load)
            targetValueDisplay.textContent = `${weeklyTargetSlider.value} kcal`;


            // --- 2. X·ª≠ l√Ω Form Submission ---
            planForm.addEventListener('submit', (e) => {
                e.preventDefault();

                // L·∫•y ng√†y ƒë√£ ch·ªçn
                const selectedDays = Array.from(
                    document.querySelectorAll('input[name="days"]:checked')
                ).map(cb => cb.value);

                // L·∫•y nh√≥m ho·∫°t ƒë·ªông
                const selectedActivity = document.querySelector('input[name="activity"]:checked');

                // L·∫•y target kcal
                const weeklyTarget = document.getElementById('weekly_target').value;

                // G·ª≠i JSON sang backend
                const payload = {
                    days: selectedDays,
                    activity: selectedActivity ? selectedActivity.value : null,
                    weekly_target: weeklyTarget,
                    weight: 60
                };

                fetch("/api/class-picker/", {
                    method: "POST",
                    headers: {
                        "Content-Type": "application/json",
                        "X-CSRFToken": csrftoken
                    },
                    body: JSON.stringify(payload)
                })
                .then(res => res.json())
                .then(data => {
                    if (data.error) {
                        planDetails.innerHTML = `<p style="color:red">${data.error}</p>`;
                    } else {
                        planDetails.innerHTML = data.table;
                        const table = planDetails.querySelector("table");
                        if (table) table.classList.add("weekly-plan-table");
                    }
                    planPopup.classList.add("show");
                });
            });


            // --- 3. H√†m t·∫°o l·ªãch t·∫≠p gi·∫£ l·∫≠p ---
            function generateMockPlan(data) {
                const numDays = data.days.length;
                if (numDays === 0) {
                    return `<p style="color: var(--color-accent); font-family: 'DynaPuff', system-ui;">Vui l√≤ng ch·ªçn √≠t nh·∫•t m·ªôt ng√†y t·∫≠p luy·ªán!</p>`;
                }
                const dailyCalorie = Math.round(data.weekly_target / numDays);

                // L·∫•y icon v√† t√™n nh√≥m ho·∫°t ƒë·ªông ƒë√£ ch·ªçn
                const selectedActivityInput = document.querySelector(`input[name="activity"]:checked`);
                const activityName = selectedActivityInput.value;
                const activityIcon = selectedActivityInput.nextElementSibling.querySelector('.activity-icon').outerHTML;

                let tableRows = '';

                data.days.forEach(day => {
                    const activityDescription = `${detailedActivity} k√©o d√†i ${data.duration} ph√∫t.`;
                    tableRows += `
                        <tr>
                            <td>${day}</td>
                            <td>${activityIcon} ${activityName}</td>
                            <td>${data.duration} minutes</td>
                            <td>~${dailyCalorie} kcal</td>
                            <td>${activityDescription}</td>
                        </tr>
                    `;
                });

                // Th√™m h√†ng cho c√°c ng√†y ngh·ªâ
                const allDays = ["Monday", "Tuesday", "Wednesday", "Thursday", "Friday", "Saturday", "Sunday"];
                allDays.filter(day => !data.days.includes(day)).forEach(day => {
                    tableRows += `
                        <tr>
                            <td>${day}</td>
                            <td>Rest day üò¥</td>
                            <td>0 minutes</td>
                            <td>0 kcal</td>
                            <td>Relax and recover your muscles</td>
                        </tr>
                    `;
                });

                // Th√¥ng tin th√™m t·ª´ d·ªØ li·ªáu kh·∫£o s√°t
                const userInfoHTML = `
                    <p style="text-align: center; margin-bottom: 25px; font-style: italic; color: #555;">
                        (User information from the initial survey: Age ${data.age}, Weight ${data.weight}kg, BMI ${data.bmi}).
                    </p>
                `;

                return `
                    ${userInfoHTML}
                    <div class="plan-table-container">
                        <table class="weekly-plan-table">
                            <thead>
                                <tr>
                                    <th>Day</th>
                                    <th>Activity Group</th>
                                    <th>Duration</th>
                                    <th>Kcal</th>
                                    <th>Detailed suggestion</th>
                                </tr>
                            </thead>
                            <tbody>
                                ${tableRows}
                            </tbody>
                        </table>
                    </div>
                    <p style="font-family: 'Maven Pro', sans-serif; font-size: 1.1rem; color: var(--color-accent); font-weight: 600; ">
                        üéâ Total calorie target for this week: ${data.weekly_target} kcal, evenly divided across ${numDays} training days.
                    </p>
                `;
            }

            // --- 4. X·ª≠ l√Ω Popup actions ---
            window.closePopup = () => {
                planPopup.classList.remove('show');
            };

            window.editPlan = () => {
                window.closePopup();
                // Logic cu·ªôn l√™n ƒë·ªÉ ch·ªânh s·ª≠a form
                window.scrollTo({ top: 0, behavior: 'smooth' });
            };
        });
    </script>

    <script>
        const aboutBtn = document.getElementById("aboutBtn");
        const aboutPopup = document.getElementById("aboutPopup");
        const popupBox = document.querySelector(".popup-box");

        // m·ªü popup
        aboutBtn.addEventListener("click", () => {
            aboutPopup.style.display = "flex";
        });

        // click ngo√†i popup ƒë·ªÉ t·∫Øt
        aboutPopup.addEventListener("click", (e) => {
            if (!popupBox.contains(e.target)) {
                aboutPopup.style.display = "none";
            }
        });
    </script>

</body>

</html>